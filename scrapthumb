#!/bin/bash
# Scrap Tumblr to get random images
# Usage: feh -dF $(./scrapthumb)

VIEWER=echo
MAXIMGS=5

# No trailing slash
SOURCES=(
	"http://tgfcp.tumblr.com"
	"http://nakedbeachess.tumblr.com"
)

##
# Do not edit below.
##

IMGS=()
preload() {
	i=0
	mod=$(echo $MAXIMGS % ${#SOURCES[*]} |bc)
	tot=$(echo $MAXIMGS / ${#SOURCES[*]} |bc)

	for src in ${SOURCES[*]}
	do
		[ $i -eq 0 -a $mod -ne 0 ] && t=$(echo $tot + 1 | bc) || t=$tot
		for n in $(seq 1 $t)
		do
			IMGS[$i]="$(wget -t 1 -qO - "$src/random" |grep -o 'property="og:image" content=".*"' |cut -b 29- |tr -d '"')"
			i=$(echo $i+1|bc)
		done
	done
}

main() {
	while getopts "n:" opt; do
		case $opt in
			n) MAXIMGS=$OPTARG;;
		esac
	done

	preload
	$VIEWER ${IMGS[*]}
}

main "$@"
