#!/bin/bash
# Scrap Tumblr to get random images
# Usage: feh --bg-scale $(scrapthumb -n1 -s http://desktopwallpaperproject.tumblr.com)

# TODO
# - Randomize the sources (-r flag)
# - Handle network errors

GETTER="wget -t1 -qO -"
VIEWER=echo
MAXIMGS=5

# No trailing slash
SOURCES=(
	"http://desktopwallpaperproject.tumblr.com"
	"http://wallpapermag.tumblr.com"
	"http://hdwallpaper.1nation.eu"
)

##
# Do not edit below.
##

IMGS=()
preload() {
	s=0
	for i in $(seq 0 $(echo $MAXIMGS - 1|bc))
	do
		src=${SOURCES[$s]}
		s=$(echo $s+1|bc)
		[ $s -ge ${#SOURCES[*]} ] && s=0
		IMGS[$i]="$($GETTER "$src/random" |grep -o 'property="og:image" content=".*"' |cut -b 29- |tr -d \")"
	done
}

usage() {
echo -n "Usage: $0 [-hns]
-s 	Source
-n	Number of items
-h	Show this helps
"

exit 1
}

main() {
	while getopts "hn:s:" opt; do
		case $opt in
			h) usage;;
			n) MAXIMGS=$OPTARG;;
			s) SOURCES=($OPTARG);;
		esac
	done

	preload
	$VIEWER ${IMGS[*]}
}

main "$@"
